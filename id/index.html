<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <link href="/favicon.ico" rel="icon" />
  <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  
  <title id="page-title">ƒêang t·∫£i...</title>
  <meta property="og:title" id="og-title" content="Locket" />
  <meta property="og:image" id="og-image" content="" />
  <meta property="og:description" id="og-description" content="" />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-B3TW13S2Y9"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-B3TW13S2Y9');
  </script>
  
  <script id="config">
    let CONFIG = {};
    
    function loadConfigFromURL() {
      const params = new URLSearchParams(window.location.search);
      
      const userId = params.get('id');
      const dynamicLink = params.get('link') ? decodeURIComponent(params.get('link')) : null;
      const imagesParam = params.get('images') ? decodeURIComponent(params.get('images')) : null;
      const friendSlots = params.get('slots') ? decodeURIComponent(params.get('slots')) : '‚àû'; // ƒê·ªçc slots, m·∫∑c ƒë·ªãnh l√† ‚àû

      if (!userId || !dynamicLink || !imagesParam) {
        document.getElementById('page-title').innerText = "L·ªói: Kh√¥ng t√¨m th·∫•y th√¥ng tin";
        return false;
      }
      
      const imageList = imagesParam.split(',');
      
      CONFIG = {
        USER_ID: userId,
        DYNAMIC_LINK: dynamicLink,
        IMAGE_LIST: imageList,
        SLIDESHOW_SPEED: 2000, 
        OG_IMAGE: imageList[0],
        FRIEND_SLOTS: friendSlots
      };
      return true;
    }
  </script>

  <style type="text/css">
    /* THAY ƒê·ªîI 2: X√ìA B·ªé @font-face B·ªä H·ªéNG */
    /* @font-face {
        font-family: 'ProximaSoft';
        src: url('/fonts/proxima_soft_bold.otf');
      } 
    */

    body {
      height: 100vh; margin: 0; 
      
      /* THAY ƒê·ªîI 3: C·∫¨P NH·∫¨T FONT-FAMILY ∆ØU TI√äN NUNITO */
      font-family: "Nunito", ui-rounded, system-ui, "ProximaSoft", sans-serif;
      
      background: linear-gradient(black, #2B1F00); 
      -webkit-font-smoothing: antialiased;
    }
    .flex-centered {
      height: 100%; padding: 0; margin: 0; display: flex;
      align-items: center; justify-content: center;
    }
    .flex-vertical {
      display: flex; align-items: center;
      justify-content: center; flex-direction: column;
    }
    .gold-shadow { box-shadow: 0 0 60px rgba(255, 199, 0, 0.5); }
    .button {
      background-color: #FFB800; padding: 18px 36px; color: rgba(0, 0, 0, 0.8);
      text-decoration: none; border-radius: 500px; font-weight: 700;
      font-size: 18px; 
      
      /* D√πng chung font-family ƒë√£ khai b√°o ·ªü body */
      /* font-family: ui-rounded, "ProximaSoft", sans-serif; */
      
      cursor: pointer; background-repeat: no-repeat; border: none;
      -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none;
      -moz-user-select: none; -ms-user-select: none; user-select: none;
    }
    .button-icon { margin-left: 6px; }
    #celebrity-image-container {
      position: absolute; top: 20px; left: -20px;
      width: 148px; height: 148px; transform: rotate(-10deg);
      border-radius: 28px; border: 6px solid #FFB900;
      overflow: hidden; z-index: 2;
    }
    .celebrity-image {
      position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      background-size: cover; background-position: center;
      transition: opacity 1s ease-in-out;
    }
    .celebrity-container { position: relative; width: 265px; height: 336px; }
    .celebrity-background {
      position: absolute; top: 0; left: 0;
      z-index: 1; width: 265px; height: 336px;
    }
    .username-subtitle-celebrity {
      color: rgba(255, 255, 255, 0.40); text-align: center; font-size: 18px;
      font-weight: 600; line-height: 24px; margin: 0;
      margin-top: -2px; margin-bottom: 40px;
    }
    .subtitle-celebrity {
      color: rgba(255, 255, 255, 0.64); font-weight: 600; font-size: 18px;
      padding: 0; margin: 0; text-align: center;
      margin-bottom: 48px; line-height: normal;
    }
    .subtitle-celebrity-highlight { color: rgba(255, 255, 255, 1.0); }
    .celebrity-second-subtitle {
      position: absolute; top: 242px; left: 0; width: 235px; height: 52px;
      padding: 0 15px; margin: 0; text-align: center;
      color: rgba(255, 255, 255, 0.60); font-size: 18px; font-weight: 600;
      line-height: 26px; word-wrap: break-word; z-index: 3;
    }
    .title {
      color: rgba(255, 255, 255, 0.9); font-weight: 700; font-size: 30px;
      padding: 0; margin: 0; margin-bottom: 6px; text-align: center;
    }
  </style>
</head>
<body>
<div class="flex-centered gold-shadow">
  <div class="flex-vertical">
    
    <h2 class="title">Th√™m t√¥i tr√™n Locket</h2>
    <h3 class="username-subtitle-celebrity" id="username-subtitle"></h3>
    <h3 class="subtitle-celebrity" id="friend-count-subtitle"></h3>

    <div class="celebrity-container">
      <img class="celebrity-background" src="https://locket.cam/images/phone_background.svg" />
      <h3 class="celebrity-second-subtitle" id="image-subtitle"></h3>
      <div id="celebrity-image-container">
      </div>
    </div>
    
    <button class="button" id="open-locket-button" onclick="openDynamicLink()">M·ªü Locket <img class="button-icon" src="https://locket.cam/images/right_arrow.svg" /></button>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    
    if (loadConfigFromURL()) {
      const userID = CONFIG.USER_ID;
      const titleText = `Th√™m ${userID} tr√™n Locket üíõ`;
      const descriptionText = `C√°c ·∫£nh t·ª´ ${userID} v√† BFF tr√™n M√†n h√¨nh ch√≠nh c·ªßa b·∫°n`;

      document.getElementById('page-title').innerText = titleText;
      document.getElementById('og-title').setAttribute('content', titleText);
      document.getElementById('og-image').setAttribute('content', CONFIG.OG_IMAGE);
      document.getElementById('og-description').setAttribute('content', descriptionText);

      document.getElementById('username-subtitle').innerText = `@${userID}`;
      
      document.getElementById('friend-count-subtitle').innerHTML = 
        `${userID} c√≥ th·ªÉ th√™m <span class="subtitle-celebrity-highlight">${CONFIG.FRIEND_SLOTS}</span> ng∆∞·ªùi b·∫°n!`;
        
      document.getElementById('image-subtitle').innerText = descriptionText;

      
      const celebrityImages = CONFIG.IMAGE_LIST;
      const container = document.getElementById('celebrity-image-container');
      
      if (celebrityImages && celebrityImages.length > 0) {
        let currentImageIndex = 0;

        const initialImage = document.createElement('div');
        initialImage.className = 'celebrity-image';
        initialImage.style.backgroundImage = `url(${celebrityImages[0]})`;
        container.appendChild(initialImage);

        if (celebrityImages.length > 1) {
          setInterval(changeImage, CONFIG.SLIDESHOW_SPEED); 
        }

        function changeImage() {
          const oldImage = container.querySelector('.celebrity-image');
          currentImageIndex = (currentImageIndex + 1) % celebrityImages.length;
          const newImage = document.createElement('div');
          newImage.className = 'celebrity-image';
          newImage.style.backgroundImage = `url(${celebrityImages[currentImageIndex]})`;
          newImage.style.opacity = '0';
          container.appendChild(newImage);
          newImage.offsetHeight; 
          newImage.style.opacity = '1';
          if (oldImage) {
            oldImage.style.opacity = '0';
            setTimeout(() => {
              if (container.contains(oldImage)) { container.removeChild(oldImage); }
            }, 1000); 
          }
        }
      }
    } else {
        document.querySelector('.flex-vertical').innerHTML = '<h1>L·ªói: Kh√¥ng t√¨m th·∫•y th√¥ng tin c·∫•u h√¨nh.</h1>';
    }
  });

  async function copyTextToClipboard(text) {
    await navigator.clipboard.write([
      new ClipboardItem({ 'text/plain': new Blob([text], { type: 'text/plain' }) })
    ]);
  }

  function isIOSDevice() {
    return [
      'iPad Simulator', 'iPhone Simulator', 'iPod Simulator',
      'iPad', 'iPhone', 'iPod'
    ].includes(navigator.platform)
    || (navigator.userAgent.includes("Mac") && "ontouchend" in document);
  }

  async function openDynamicLink() {
    const link = CONFIG.DYNAMIC_LINK; 
    if (isIOSDevice()) {
      copyTextToClipboard(link);
    }
    window.location.href = link;
  }
</script>

</body>
</html>
